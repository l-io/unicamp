/* Roteiro 5 - EA871-2S2017 - Programa 5  */

#include "derivative.h" /* include peripheral declarations */
#define BIT18	0x00040000;
#define SET_BIT(reg, idx)	reg = (reg | (1 << idx))		// Macro que seta o bit idx do registrador reg


void init_GPIO(){

	SET_BIT(SIM_SCGC5, 10);		   			// Habilita clock do PORTB (System Clock Gating Control
	PORTB_PCR18 = PORTB_PCR18 & 0xFFFFF8FF;	// Zera bits de MUX de PTB18
	SET_BIT(PORTB_PCR18, 8);				// Seta bit 0 do MUX de PTB18, assim os bits de MUX serao 001
	SET_BIT(GPIOB_PDDR, 18);				// Seta pino 18 do PORTB como saida 
}

void delay(uint32_t t){		// atrasa t milisegundos
	
	__asm volatile(
			"ldr r3,=0x12385678 \n"
			"wait: \n"
			"nop \n"
			);
	
	return;
}

int main(void) {
	
	init_GPIO();

	for(;;){
		GPIOB_PTOR = BIT18;			// Toggle led vermelho
		delay(1000);				// espera 1 segundo
	}
}
